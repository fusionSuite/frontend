<!--
 - FusionSuite - Frontend
 - Copyright (C) 2022 FusionSuite
 -
 - This program is free software: you can redistribute it and/or modify
 - it under the terms of the GNU Affero General Public License as published by
 - the Free Software Foundation, either version 3 of the License, or
 - any later version.
 -
 - This program is distributed in the hope that it will be useful,
 - but WITHOUT ANY WARRANTY; without even the implied warranty of
 - MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the
 - GNU Affero General Public License for more details.
 -
 - You should have received a copy of the GNU Affero General Public License
 - along with this program.  If not, see <http://www.gnu.org/licenses/>.
 -->

<app-page i18n-page-title page-title="Items">
  <header class="page__header">
    <h1 *ngIf="type !== null" i18n>{{ type.name }}</h1>
  </header>

  <div class="page__inner flow">
    <a class="a--action" [routerLink]="['/items/' + internalname + '/new']" data-cy="link-items-new">
      <fa-icon icon="plus" [fixedWidth]="true"></fa-icon>
      <ng-container i18n>
        Create an item
      </ng-container>
    </a>
    <span class="page__counters" *ngIf="contentRange !== ''">
      {{ contentRange }} items
      <fa-icon
        icon="angles-left"
        [fixedWidth]="true"
        *ngIf="links.first !== undefined"
        class="page__counters__navigation"
        (click)="loadItems(links.first)"
      >
      </fa-icon>
      <fa-icon
        icon="angles-left"
        [fixedWidth]="true"
        *ngIf="links.first === undefined"
        class="page__counters__navigation disabled"
      >
      </fa-icon>

      <fa-icon
        icon="angle-left"
        [fixedWidth]="true"
        *ngIf="links.prev !== undefined"
        class="page__counters__navigation"
        (click)="loadItems(links.prev)"
      >
      </fa-icon>
      <fa-icon
        icon="angle-left"
        [fixedWidth]="true"
        *ngIf="links.prev === undefined"
        class="page__counters__navigation disabled"
      >
      </fa-icon>

      <span>
        <ng-select
          [clearable]="false"
          class="page__counters__pages"
          [(ngModel)]="currentPageNumber"
          (change)="changePage($event)"
        >
        <ng-option
          *ngFor="let page of pages"
          [value]="page"
        >
          {{ page }}
        </ng-option>
        </ng-select>
      </span>

      <fa-icon
        icon="angle-right"
        [fixedWidth]="true"
        *ngIf="links.next !== undefined"
        class="page__counters__navigation"
        (click)="loadItems(links.next)"
      >
      </fa-icon>
      <fa-icon
        icon="angle-right"
        [fixedWidth]="true"
        *ngIf="links.next === undefined"
        class="page__counters__navigation disabled"
      >
      </fa-icon>

      <fa-icon
        icon="angles-right"
        [fixedWidth]="true"
        *ngIf="links.last !== undefined"
        class="page__counters__navigation"
        (click)="loadItems(links.last)"
      >
      </fa-icon>
      <fa-icon
        icon="angles-right"
        [fixedWidth]="true"
        *ngIf="links.last === undefined"
        class="page__counters__navigation disabled"
      >
      </fa-icon>
    </span>

    <table>
      <thead>
        <tr>
          <th i18n>
            Name
            <span class="form__edit__item__value">
              <input [(ngModel)]="search" (ngModelChange)="searchUpdate.next($event)">
            </span>  
          </th>
          <th class="col--actions">
            <fa-icon
              [icon]="['far', 'circle-xmark']"
              [fixedWidth]="true"
              *ngIf="search !== ''"
              style="left: -65px; position: relative; top: 10px; cursor: pointer;"
              (click)="searchUpdate.next(''); search = ''"
            ></fa-icon>
            <fa-icon icon="wrench" [fixedWidth]="true"></fa-icon>

            <span class="sr-only" i18n>
              Actions
            </span>
          </th>
        </tr>
      </thead>

      <tbody data-cy="list-items">
        <tr *ngFor="let item of items | sortBy:'asc':'name'" data-cy="item-items">
          <td>
            <a
              class="a--animation"
              [routerLink]="['/items/' + item.id]"
              [id]="item.id"
              [name]="item.name"
            >
              {{ item.name }}
            </a>
          </td>

          <td class="col--actions">
            <form [formGroup]="deleteForm" (ngSubmit)="deleteItem(item)">
              <button
                type="submit"
                i18n-title
                title="Delete {{ item.name }}"
                data-cy="button-item-delete"
              >
                <fa-icon icon="trash" [fixedWidth]="true"></fa-icon>

                <span class="sr-only" i18n>
                  Delete {{ item.name }}
                </span>
              </button>
            </form>
          </td>
        </tr>

        <tr *ngIf="!itemsLoaded">
          <td colspan="2" class="loader flow">
            <div class="loader__spinner"></div>

            <p class="loader__message" i18n>
              Loading of itemsâ€¦
            </p>
          </td>
        </tr>

        <tr *ngIf="itemsLoaded && items.length === 0" class="tr--placeholder">
          <td colspan="2" i18n>
            There are no items to show.
          </td>
        </tr>
      </tbody>
    </table>
  </div>
</app-page>
